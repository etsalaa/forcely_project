package forcely;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class CustomerService {
    
    public void registerCustomer(Customer customer) throws Exception {
            DB db = new DB();
            Connection con = null;
            String sql = "INSERT INTO Customer (firstname, lastname, phone, street, area, postalcode, email) VALUES (?, ?, ?, ?, ?, ?, ?);";
            try {

            con = db.getConnection();
            PreparedStatement stmt = con.prepareStatement(sql);
            stmt.setString(1, customer.getFirstname());
            stmt.setString(2, customer.getLastname());
            stmt.setString(3, customer.getPhone());
            stmt.setString(4, customer.getStreet());
            stmt.setString(5, customer.getArea());
            stmt.setString(6, customer.getPostalcode());
            stmt.setString(7, customer.getEmail());
            
            stmt.executeUpdate();

            stmt.close();
            db.close();

        } catch (Exception e) {
            throw e;
        } finally {
            try {
                db.close();
            } catch (Exception e) {

            }

        }

    }

    public List<Customer> getCustomers() throws Exception {

        List<Customer> customers = new ArrayList<Customer>();

        DB db = new DB();
        Connection con = null;
        String query = "SELECT * FROM Customer ORDER BY lastname, firstname;";
        try {

            con = db.getConnection();
            PreparedStatement stmt = con.prepareStatement(query);

            ResultSet rs = stmt.executeQuery();

            while (rs.next()) {
                customers.add(new Customer(rs.getString("Customer.firstname"),
                        rs.getString("Customer.lastname"),
                        rs.getString("Customer.phone"),
                        rs.getString("Customer.street"),
                        rs.getString("Customer.area"),
                        rs.getString("Customer.postalcode"),
                        rs.getString("Customer.email")));
            }

            rs.close();
            stmt.close();
            db.close();

            return customers;

        } catch (Exception e) {
            throw e;
        } finally {
            try {
                db.close();
            } catch (Exception e) {

            }

        }

    }


    public List<Customer> searchCustomersByLastname(String lastname) throws Exception {
        List<Customer> customers = new ArrayList<Customer>();

        DB db = new DB();
        Connection con = null;
        String query = "SELECT * FROM Customer WHERE lastname=? ORDER BY firstname;";

        try {
            con = db.getConnection();
            PreparedStatement stmt = con.prepareStatement(query);

            // setting parameter
            stmt.setString(1, lastname);

            ResultSet rs = stmt.executeQuery();

            while (rs.next()) {
                customers.add(new Customer(rs.getString("Customer.firstname"),
                    rs.getString("Customer.lastname"),
                    rs.getString("Customer.phone"),
                    rs.getString("Customer.street"),
                    rs.getString("Customer.area"),
                    rs.getString("Customer.postalcode"),
                    rs.getString("Customer.email")));
            }

            rs.close();
            stmt.close();
            db.close();

            return customers;
            
        } catch (Exception e) {
            throw e;
        } finally {
            try {
                db.close();
            } catch (Exception e) {
                
            }
        }

	}



}
